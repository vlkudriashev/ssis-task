### Описание файлов репозитория:
* Папка source-files содержит исходные CSV и TXT файлы
* Папка sql-scripts содержит скрипт для создания исходных таблиц и код задач обработки данных внутри пакета

### Описание объектов БД:
* Temporary area (именуется как "tmp" в sql-коде) - схема для загрузки необработанных данных. Таблицы в этой схеме не содержит первичных ключей
* Target area (именуется как "ta" в sql-коде) - схема для загрузки обработанных данных

### Глоссарий:

* Control Flow - Поток управления
* Data Flow - Поток данных

### Подготовка решения к запуску:

0. Загрузить файлы проекта в каталог с разрешением на запись файлов и создание папок.
1. Запустить скрипт "set_database.sql" из папки "sql-scripts" для создания начальной базы данных, схем и таблиц
3. Настроить локальную переменную "outFolder" в соответствии с шаблоном: "Расположение_каталога_проекта\\output-files", например, "С:\\Users\\Vasily\\ssis-project\\output-files". Каталоги отделены двойным слешем, так как в дальнейшем будут переданы в C# скрипт. Такое разделение каталогов гарантированно работает для Windows-машины
4. Изменить путь к файлам для задачи потока управления "Foreach Loop Container" на локальный путь к каталогу "source-files"
5. Во вкладке соединений поменять настройки соединений к СУБД и CSV файлам на соответствующие локальные значения. Соединение Employee соответствует файлу source1.csv, соединение Department соответствует файлу source2.csv.

### Описание решения:

1. На первом шаге производится удаление данных из таблиц "tmp" схемы, чтобы при перезапуске пакета и повторном импорте данных из CSV в "tmp" слой не было дубликатов данных.
2. Данные из CSV файлов загружаются в соответствующие таблицы "tmp" схемы. Загрузка данных разбита на два потока управления, чтобы задачи можно было перезапускать независимо друг от друга (при наличии точки сохранения). Если бы задачи загрузки данных находились в одном потоке управления, но в разных потоках данных, то перезапуск по отдельности был бы невозможен.
3. Производится слияние данных соответствующих таблиц "Temporary" и "Target" схем. Это позволяет избежать ошибок в случае, когда в таблицах есть записи с одинаковыми значениями первичного ключа ID. Отсутствующие данные будут добавлены в "Target" таблицы, а совпадающие значения заменены (обновлены).
4. В папке "output-files" создаётся архивная папка с именем в формате "YYYYMMDD_HHMMSS". Задача выполняется при помощи скрипта на языке C#.
5. Файлы перемещаются в архив для хранения. Процесс выполняется на завершающем этапе, чтобы при перезапуске пакета исходные файлы были доступны в начальном каталоге.
